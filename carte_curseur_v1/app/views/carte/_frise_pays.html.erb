<% 
@cow_code = ActiveRecord::Base.connection.select_value(
"SELECT cowcode from fips_cow_codes WHERE  fips_cntry = '#{@id[0..1]}' LIMIT 1"
)
# TODO: on pourrait faire une seule requete sql en utilisant select_one (selectionner une ligne contenant les 2 colonnes que l on veut
@identifieryear_var = ActiveRecord::Base.connection.select_value( 
  "SELECT identifieryear_var   FROM datasets where id = 6 LIMIT 1")
@identifierccode1_var = ActiveRecord::Base.connection.select_value(
  "SELECT identifierccode1_var FROM datasets where id = 6 LIMIT 1")

@donnees_frise = ActiveRecord::Base.connection.select_all(
      "SELECT var#{@variable} as donnee, var#{@identifieryear_var} as annee from dataset_#{@dataset} where var#{@identifierccode1_var}='#{@cow_code}' and (var#{@identifieryear_var} >= #{@debut_periode}) and (var#{@identifieryear_var} <= #{@fin_periode}) order by var#{@identifieryear_var}"
          )
@long_annee = (600 / (@fin_periode - @debut_periode + 1)).to_i
%>


<%= @debut_periode %>


<%
compt_annee = @debut_periode
@donnees_frise.each do |ligne|
%>
<%= ligne['annee'] %>
<%= compt_annee %>

<%
if ligne['annee'].to_i == compt_annee.to_i
%>

	<div
	style="overflow:hidden; position:relative;
	height:15px;
	width:<%= @long_annee %>px;
	background-color:#0000FF;
	float: left;
	text-align: center;">
	o
	</div>
	<% compt_annee = compt_annee + 1 %>
	
<% 	end %>


<% compt_annee = compt_annee + 1 %>
	
<% end %>

